<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y NOT RUN</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --black: #0a0a0a; --red: #ff0000; --dark-red: #cc0000; --white: #ffffff; --gray: #333333; --light-gray: #666666; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto Mono', monospace; background: var(--black); color: var(--white); min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 480px; margin: 0 auto; padding: 20px; min-height: 100vh; }
        .screen { display: none; animation: fadeIn 0.3s ease-in; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { text-align: center; padding: 40px 0; border-bottom: 2px solid var(--red); margin-bottom: 40px; }
        .header-small { padding: 20px 0; margin-bottom: 20px; }
        .logo { font-family: 'Anton', sans-serif; font-size: 48px; letter-spacing: 4px; color: var(--red); text-shadow: 3px 3px 0px rgba(255, 0, 0, 0.3); animation: pulse 2s ease-in-out infinite; }
        .logo-small { font-size: 32px; animation: none; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        .tagline { font-size: 12px; color: var(--light-gray); margin-top: 10px; letter-spacing: 2px; }
        .btn { width: 100%; padding: 18px; font-family: 'Roboto Mono', monospace; font-size: 14px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; border: 2px solid var(--red); background: transparent; color: var(--red); cursor: pointer; transition: all 0.2s; margin: 10px 0; }
        .btn:hover { background: var(--red); color: var(--black); transform: translateY(-2px); }
        .btn-primary { background: var(--red); color: var(--black); }
        .btn-primary:hover { background: var(--dark-red); border-color: var(--dark-red); }
        .btn-small { padding: 12px; font-size: 12px; }
        .btn-danger { border-color: var(--light-gray); color: var(--light-gray); }
        .btn-danger:hover { background: var(--light-gray); color: var(--black); }
        .btn-google { background: var(--white); color: #333; border: 2px solid var(--white); display: flex; align-items: center; justify-content: center; gap: 12px; }
        .btn-google:hover { background: #f0f0f0; border-color: #f0f0f0; color: #333; transform: translateY(-2px); }
        .btn-google svg { width: 20px; height: 20px; }
        .form-group { margin: 30px 0; }
        .form-label { display: block; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--light-gray); margin-bottom: 15px; }
        .activity-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .activity-btn { padding: 30px 20px; border: 2px solid var(--gray); background: transparent; color: var(--white); font-family: 'Roboto Mono', monospace; font-size: 16px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .activity-btn:hover { border-color: var(--red); }
        .activity-btn.selected { border-color: var(--red); background: var(--red); color: var(--black); }
        .frequency-options { display: flex; gap: 10px; }
        .frequency-btn { flex: 1; padding: 20px; border: 2px solid var(--gray); background: transparent; color: var(--white); font-family: 'Roboto Mono', monospace; font-size: 14px; cursor: pointer; transition: all 0.2s; }
        .frequency-btn:hover { border-color: var(--red); }
        .frequency-btn.selected { border-color: var(--red); background: var(--red); color: var(--black); }
        .intensity-slider { display: flex; flex-direction: column; gap: 10px; }
        .intensity-option { padding: 20px; border: 2px solid var(--gray); background: transparent; color: var(--white); cursor: pointer; transition: all 0.2s; }
        .intensity-option:hover { border-color: var(--red); }
        .intensity-option.selected { border-color: var(--red); background: var(--red); color: var(--black); }
        .intensity-title { font-size: 16px; font-weight: 700; text-transform: uppercase; margin-bottom: 5px; }
        .intensity-desc { font-size: 11px; opacity: 0.7; }
        .stat-card { background: var(--gray); border: 2px solid var(--red); padding: 30px; margin: 20px 0; text-align: center; }
        .stat-number { font-family: 'Anton', sans-serif; font-size: 72px; color: var(--red); line-height: 1; margin: 10px 0; }
        .stat-label { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--light-gray); }
        .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin: 20px 0; }
        .day-box { aspect-ratio: 1; border: 2px solid var(--gray); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; }
        .day-box.completed { background: var(--red); border-color: var(--red); color: var(--black); }
        .excuse-list { background: var(--gray); padding: 20px; margin: 20px 0; }
        .excuse-title { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--light-gray); margin-bottom: 15px; }
        .excuse-item { padding: 10px 0; border-bottom: 1px solid var(--light-gray); font-size: 12px; }
        .excuse-item:last-child { border-bottom: none; }
        .premium-banner { background: linear-gradient(135deg, var(--red) 0%, var(--dark-red) 100%); padding: 25px; margin: 30px 0; border: 2px solid var(--red); cursor: pointer; transition: transform 0.2s; }
        .premium-banner:hover { transform: scale(1.02); }
        .premium-title { font-family: 'Anton', sans-serif; font-size: 24px; color: var(--black); margin-bottom: 10px; }
        .premium-price { font-size: 14px; color: var(--black); opacity: 0.8; }
        .premium-features { margin: 20px 0; }
        .premium-feature { padding: 15px; background: rgba(51, 51, 51, 0.8); margin: 10px 0; font-size: 12px; display: flex; justify-content: space-between; align-items: flex-start; gap: 15px; }
        .premium-feature-content { flex: 1; }
        .premium-feature-status { font-size: 11px; font-weight: 700; white-space: nowrap; padding-top: 2px; }
        .premium-feature.locked .premium-feature-status { color: var(--light-gray); }
        .premium-feature.unlocked .premium-feature-status { color: var(--red); }
        .custom-times-section { background: var(--gray); border: 2px solid var(--red); padding: 20px; margin: 20px 0; display: none; }
        .custom-times-section.visible { display: block; }
        .custom-times-title { font-size: 14px; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; color: var(--red); }
        .custom-times-current { font-size: 12px; color: var(--light-gray); margin-bottom: 15px; }
        .time-picker-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .time-slot { padding: 10px 5px; border: 2px solid var(--gray); background: transparent; color: var(--white); font-family: 'Roboto Mono', monospace; font-size: 12px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .time-slot:hover { border-color: var(--red); }
        .time-slot.selected { border-color: var(--red); background: var(--red); color: var(--black); }
        .settings-section { background: var(--gray); padding: 20px; margin: 15px 0; border: 2px solid var(--gray); }
        .settings-section-title { font-size: 14px; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; color: var(--red); }
        .settings-current { font-size: 12px; color: var(--light-gray); margin-bottom: 10px; }
        .settings-value { color: var(--white); font-weight: 700; }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .settings-option { padding: 12px; border: 2px solid var(--light-gray); background: transparent; color: var(--white); font-family: 'Roboto Mono', monospace; font-size: 12px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
        .settings-option:hover { border-color: var(--red); }
        .settings-option.selected { border-color: var(--red); background: var(--red); color: var(--black); }
        .settings-option.disabled { opacity: 0.5; cursor: not-allowed; }
        .faq-item { background: var(--gray); margin: 15px 0; border: 2px solid var(--gray); overflow: hidden; }
        .faq-question { padding: 20px; font-size: 14px; font-weight: 700; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
        .faq-question:hover { color: var(--red); }
        .faq-toggle { font-size: 18px; color: var(--red); transition: transform 0.2s; }
        .faq-item.open .faq-toggle { transform: rotate(45deg); }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .faq-item.open .faq-answer { max-height: 500px; }
        .faq-answer-content { padding: 0 20px 20px 20px; font-size: 13px; line-height: 1.6; color: var(--light-gray); }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--black); border-top: 2px solid var(--red); display: flex; padding: 8px 5px; max-width: 480px; margin: 0 auto; }
        .nav-btn { flex: 1; padding: 12px 5px; background: transparent; border: none; color: var(--light-gray); font-family: 'Roboto Mono', monospace; font-size: 9px; letter-spacing: 0.5px; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .nav-btn.active { color: var(--red); }
        .content-wrapper { padding-bottom: 80px; }
        .permission-box { background: var(--gray); border: 2px solid var(--red); padding: 30px; text-align: center; margin: 20px 0; }
        .permission-icon { font-size: 48px; margin: 20px 0; }
        .permission-text { font-size: 14px; line-height: 1.6; margin: 20px 0; }
        .status-badge { display: inline-block; padding: 5px 10px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; border-radius: 3px; }
        .status-badge.premium { background: var(--red); color: var(--black); }
        .status-badge.free { background: var(--gray); color: var(--light-gray); border: 1px solid var(--light-gray); }
        .user-info { display: flex; align-items: center; gap: 10px; padding: 15px; background: var(--gray); margin-bottom: 20px; border-radius: 5px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--red); }
        .user-details { flex: 1; }
        .user-name { font-size: 14px; font-weight: 700; }
        .user-email { font-size: 11px; color: var(--light-gray); }
        .loading-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; }
        .loading-spinner { width: 50px; height: 50px; border: 3px solid var(--gray); border-top-color: var(--red); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading Screen -->
        <div id="screen-loading" class="screen active">
            <div class="loading-screen">
                <div class="logo" style="margin-bottom: 30px;">Y NOT RUN</div>
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="screen-login" class="screen">
            <div class="header">
                <div class="logo">Y NOT RUN</div>
                <div class="tagline">STOP MAKING EXCUSES</div>
            </div>
            <div style="text-align: center; margin: 40px 0;">
                <div style="font-size: 14px; margin-bottom: 30px; color: var(--light-gray);">Sign in to track your progress across all devices</div>
                <button class="btn btn-google" id="btn-google-signin">
                    <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Continue with Google
                </button>
            </div>
            <div style="text-align: center; font-size: 11px; color: var(--light-gray); margin-top: 40px;">
                By signing in, you agree to our Terms of Service
            </div>
        </div>

        <!-- Onboarding Screen 1: Activity -->
        <div id="screen-activity" class="screen">
            <div class="header">
                <div class="logo">Y NOT RUN</div>
                <div class="tagline">STOP MAKING EXCUSES</div>
            </div>
            <div class="form-group">
                <div class="form-label">What are you NOT doing?</div>
                <div class="activity-grid">
                    <button class="activity-btn" data-activity="run">RUN</button>
                    <button class="activity-btn" data-activity="lift">LIFT</button>
                    <button class="activity-btn" data-activity="swim">SWIM</button>
                    <button class="activity-btn" data-activity="bike">BIKE</button>
                </div>
            </div>
            <button class="btn btn-primary" id="btn-continue-activity" disabled>CONTINUE</button>
        </div>

        <!-- Onboarding Screen 2: Frequency -->
        <div id="screen-frequency" class="screen">
            <div class="header"><div class="logo">Y NOT RUN</div></div>
            <div class="form-group">
                <div class="form-label">How often should you be doing this?</div>
                <div class="frequency-options">
                    <button class="frequency-btn" data-frequency="3">3x/week</button>
                    <button class="frequency-btn" data-frequency="5">5x/week</button>
                    <button class="frequency-btn" data-frequency="7">Daily</button>
                </div>
            </div>
            <button class="btn btn-primary" id="btn-continue-frequency" disabled>CONTINUE</button>
            <button class="btn" id="btn-back-frequency">BACK</button>
        </div>

        <!-- Onboarding Screen 3: Intensity -->
        <div id="screen-intensity" class="screen">
            <div class="header"><div class="logo">Y NOT RUN</div></div>
            <div class="form-group">
                <div class="form-label">How aggressive should we be?</div>
                <div class="intensity-slider">
                    <div class="intensity-option" data-intensity="chill">
                        <div class="intensity-title">CHILL</div>
                        <div class="intensity-desc">Friendly reminders, 2x per day</div>
                    </div>
                    <div class="intensity-option" data-intensity="real">
                        <div class="intensity-title">REAL</div>
                        <div class="intensity-desc">Direct callouts, 3x per day</div>
                    </div>
                    <div class="intensity-option" data-intensity="brutal">
                        <div class="intensity-title">BRUTAL</div>
                        <div class="intensity-desc">No mercy, constant pressure (Premium)</div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" id="btn-continue-intensity" disabled>CONTINUE</button>
            <button class="btn" id="btn-back-intensity">BACK</button>
        </div>

        <!-- Notification Permission Screen -->
        <div id="screen-permission" class="screen">
            <div class="header"><div class="logo">Y NOT RUN</div></div>
            <div class="permission-box">
                <div class="permission-icon">üîî</div>
                <div class="permission-text">We need permission to call you out when you're slacking.<br><br>Enable notifications or this app is completely useless.</div>
            </div>
            <button class="btn btn-primary" id="btn-enable-notifications">ENABLE NOTIFICATIONS</button>
            <button class="btn" id="btn-skip-notifications">SKIP (NOT RECOMMENDED)</button>
        </div>

        <!-- Home Screen -->
        <div id="screen-home" class="screen">
            <div class="content-wrapper">
                <div class="header">
                    <div class="logo">Y NOT RUN</div>
                    <div class="tagline" id="home-tagline">STOP MAKING EXCUSES</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">CURRENT STREAK</div>
                    <div class="stat-number" id="streak-count">0</div>
                    <div class="stat-label">DAYS</div>
                </div>
                <div id="free-user-prompt" style="display: none; background: var(--gray); border: 2px solid var(--red); padding: 20px; margin: 20px 0; text-align: center; cursor: pointer;" onclick="document.querySelector('[data-screen=premium]').click();">
                    <div style="font-size: 14px; font-weight: 700; margin-bottom: 5px;">UNLOCK BRUTAL MODE</div>
                    <div style="font-size: 11px; color: var(--light-gray);">Get 8x notifications + streak protection for $2.99/mo</div>
                </div>
                <div class="form-label">THIS WEEK</div>
                <div class="week-grid" id="week-grid">
                    <div class="day-box">M</div><div class="day-box">T</div><div class="day-box">W</div><div class="day-box">T</div><div class="day-box">F</div><div class="day-box">S</div><div class="day-box">S</div>
                </div>
                <div class="excuse-list" id="excuse-list">
                    <div class="excuse-title">YOUR EXCUSES THIS WEEK</div>
                    <div class="excuse-item">No excuses yet. Good.</div>
                </div>
                <button class="btn btn-primary" id="btn-log-workout">I DID IT TODAY</button>
                <button class="btn" id="btn-skip-today">SKIP TODAY</button>
            </div>
            <div class="nav-bar">
                <button class="nav-btn active" data-screen="home">HOME</button>
                <button class="nav-btn" data-screen="premium">PREMIUM</button>
                <button class="nav-btn" data-screen="settings">SETTINGS</button>
                <button class="nav-btn" data-screen="faq">FAQ</button>
            </div>
        </div>

        <!-- Premium Screen -->
        <div id="screen-premium" class="screen">
            <div class="content-wrapper">
                <div class="header header-small">
                    <div class="logo logo-small">PREMIUM</div>
                    <div class="tagline">UNLOCK HARDCORE MODE</div>
                </div>
                <div class="premium-banner" id="premium-banner">
                    <div class="premium-title">GO PREMIUM</div>
                    <div class="premium-price">$2.99/MONTH</div>
                </div>
                <div class="premium-features" id="premium-features-list">
                    <div class="premium-feature" data-feature="brutal">
                        <div class="premium-feature-content"><strong>BRUTAL MODE</strong><br>8 notifications per day. Aggressive messaging. Maximum pressure.</div>
                        <div class="premium-feature-status">üîí LOCKED</div>
                    </div>
                    <div class="premium-feature" data-feature="streak">
                        <div class="premium-feature-content"><strong>STREAK PROTECTION</strong><br>One free skip pass per week. Protect your streak.</div>
                        <div class="premium-feature-status">üîí LOCKED</div>
                    </div>
                    <div class="premium-feature" data-feature="custom">
                        <div class="premium-feature-content"><strong>CUSTOM TIMES</strong><br>Set exactly when you want notifications. Your schedule.</div>
                        <div class="premium-feature-status">üîí LOCKED</div>
                    </div>
                    <div class="premium-feature" data-feature="adfree">
                        <div class="premium-feature-content"><strong>AD-FREE</strong><br>No upgrade prompts. Clean experience.</div>
                        <div class="premium-feature-status">üîí LOCKED</div>
                    </div>
                </div>
                <div class="custom-times-section" id="custom-times-section">
                    <div class="custom-times-title">üìÖ SET YOUR NOTIFICATION TIMES</div>
                    <div class="custom-times-current" id="current-times-display">Select up to 8 times for daily notifications</div>
                    <div class="time-picker-grid" id="time-picker-grid"></div>
                    <button class="btn btn-primary btn-small" id="btn-save-times">SAVE TIMES</button>
                </div>
                <button class="btn btn-primary" id="btn-upgrade">UPGRADE NOW</button>
            </div>
            <div class="nav-bar">
                <button class="nav-btn" data-screen="home">HOME</button>
                <button class="nav-btn active" data-screen="premium">PREMIUM</button>
                <button class="nav-btn" data-screen="settings">SETTINGS</button>
                <button class="nav-btn" data-screen="faq">FAQ</button>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="screen-settings" class="screen">
            <div class="content-wrapper">
                <div class="header header-small">
                    <div class="logo logo-small">SETTINGS</div>
                    <div class="tagline">CUSTOMIZE YOUR EXPERIENCE</div>
                </div>
                <div class="user-info" id="user-info">
                    <img class="user-avatar" id="user-avatar" src="" alt="Avatar">
                    <div class="user-details">
                        <div class="user-name" id="user-name">User</div>
                        <div class="user-email" id="user-email-display">user@email.com</div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-section-title">üìä Account Status</div>
                    <div class="settings-current">Status: <span id="settings-status" class="status-badge free">FREE</span></div>
                    <button class="btn btn-small" id="btn-manage-subscription" style="display: none;">MANAGE SUBSCRIPTION</button>
                    <button class="btn btn-primary btn-small" id="btn-upgrade-settings">UPGRADE TO PREMIUM</button>
                </div>
                <div class="settings-section">
                    <div class="settings-section-title">üèÉ Activity</div>
                    <div class="settings-current">Currently tracking: <span id="settings-activity" class="settings-value">RUN</span></div>
                    <div class="settings-grid">
                        <button class="settings-option" data-setting-activity="run">RUN</button>
                        <button class="settings-option" data-setting-activity="lift">LIFT</button>
                        <button class="settings-option" data-setting-activity="swim">SWIM</button>
                        <button class="settings-option" data-setting-activity="bike">BIKE</button>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-section-title">üìÖ Frequency</div>
                    <div class="settings-current">Goal: <span id="settings-frequency" class="settings-value">5x/week</span></div>
                    <div class="settings-grid">
                        <button class="settings-option" data-setting-frequency="3">3x/week</button>
                        <button class="settings-option" data-setting-frequency="5">5x/week</button>
                        <button class="settings-option" data-setting-frequency="7">Daily</button>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-section-title">üî• Notification Intensity</div>
                    <div class="settings-current">Current mode: <span id="settings-intensity" class="settings-value">REAL</span></div>
                    <div class="settings-grid">
                        <button class="settings-option" data-setting-intensity="chill">CHILL</button>
                        <button class="settings-option" data-setting-intensity="real">REAL</button>
                        <button class="settings-option" data-setting-intensity="brutal">BRUTAL üëë</button>
                    </div>
                    <div id="brutal-notice" style="font-size: 11px; color: var(--light-gray); margin-top: 10px; display: none;">üëë BRUTAL mode requires Premium</div>
                </div>
                <div class="settings-section">
                    <div class="settings-section-title">üîî Notifications</div>
                    <div class="settings-current">Status: <span id="settings-notifications" class="settings-value">ENABLED</span></div>
                    <button class="btn btn-small" id="btn-enable-notifications-settings">RE-ENABLE NOTIFICATIONS</button>
                </div>
                <div class="settings-section">
                    <div class="settings-section-title">üö™ Account</div>
                    <button class="btn btn-small" id="btn-sign-out">SIGN OUT</button>
                </div>
            </div>
            <div class="nav-bar">
                <button class="nav-btn" data-screen="home">HOME</button>
                <button class="nav-btn" data-screen="premium">PREMIUM</button>
                <button class="nav-btn active" data-screen="settings">SETTINGS</button>
                <button class="nav-btn" data-screen="faq">FAQ</button>
            </div>
        </div>

        <!-- FAQ Screen -->
        <div id="screen-faq" class="screen">
            <div class="content-wrapper">
                <div class="header header-small">
                    <div class="logo logo-small">FAQ</div>
                    <div class="tagline">GOT QUESTIONS?</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">How do notifications work?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Y NOT RUN sends push notifications to remind you to work out. The number depends on your intensity: CHILL (2x/day), REAL (3x/day), or BRUTAL (8x/day, Premium only). Make sure notifications are enabled in your browser settings.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">How do I cancel my subscription?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Go to Settings ‚Üí Manage Subscription. This takes you to Stripe where you can cancel anytime. Premium features stay active until the end of your billing period.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">What is Streak Protection?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Premium users get one "skip pass" per week. Use it to skip a day without breaking your streak. Without it, skipping resets your streak to zero.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Why can't I use BRUTAL mode?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">BRUTAL mode is Premium only. It unlocks 8 notifications per day with maximum pressure. Upgrade for $2.99/month to access it.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">How do I change notification times?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Custom times are a Premium feature. Once upgraded, go to Premium tab and use the time picker to select up to 8 specific notification times.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Is my data private?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Yes. Your data is stored securely in Firebase and tied to your Google account. We only store what's necessary for notifications and progress tracking. We never sell your data.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Can I use this on multiple devices?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Yes! Sign in with the same Google account on any device and your progress, settings, and premium status will sync automatically.</div></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">How do I contact support?<span class="faq-toggle">+</span></div>
                    <div class="faq-answer"><div class="faq-answer-content">Email support@ynotrun.com. We typically respond within 24 hours.</div></div>
                </div>
                <div style="text-align: center; margin-top: 30px; padding: 20px;">
                    <div style="font-size: 11px; color: var(--light-gray); letter-spacing: 1px;">STILL HAVE QUESTIONS?</div>
                    <button class="btn btn-small" style="margin-top: 15px;" onclick="window.location.href='mailto:support@ynotrun.com'">CONTACT SUPPORT</button>
                </div>
            </div>
            <div class="nav-bar">
                <button class="nav-btn" data-screen="home">HOME</button>
                <button class="nav-btn" data-screen="premium">PREMIUM</button>
                <button class="nav-btn" data-screen="settings">SETTINGS</button>
                <button class="nav-btn active" data-screen="faq">FAQ</button>
            </div>
        </div>
    </div>

    <script src="https://js.stripe.com/v3/"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, setDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDNQtNS2I67kPOIRMVN2NB_qqY3X9lqf_k",
            authDomain: "ynotrun-7cd5c.firebaseapp.com",
            projectId: "ynotrun-7cd5c",
            storageBucket: "ynotrun-7cd5c.firebasestorage.app",
            messagingSenderId: "682603769946",
            appId: "1:682603769946:web:6ea4a821df1380e65d6863"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const messaging = getMessaging(app);
        const provider = new GoogleAuthProvider();

        // Make available globally
        window.auth = auth;
        window.db = db;
        window.messaging = messaging;
        window.provider = provider;
        window.signInWithPopup = signInWithPopup;
        window.signOut = signOut;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.updateDoc = updateDoc;
        window.getToken = getToken;

        // Handle foreground messages
        onMessage(messaging, (payload) => {
            console.log('Message received:', payload);
            if (Notification.permission === 'granted') {
                new Notification(payload.notification.title, { body: payload.notification.body, icon: 'üèÉ', requireInteraction: true });
            }
        });

        // Auth state listener
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log('User signed in:', user.email);
                window.currentUser = user;
                await loadUserData(user);
            } else {
                console.log('No user signed in');
                window.currentUser = null;
                showScreen('login');
            }
        });

        // Load user data from Firestore
        async function loadUserData(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    window.appState = { ...window.appState, ...data };
                    console.log('Loaded user data:', data);
                    
                    // Update UI with user info
                    updateUserInfo(user);
                    updateHomeScreen();
                    updateSettingsScreen();
                    
                    // Check if onboarding complete
                    if (data.activity && data.frequency && data.intensity) {
                        showScreen('home');
                    } else {
                        showScreen('activity');
                    }
                } else {
                    // New user - create document
                    console.log('New user, creating document');
                    await setDoc(doc(db, 'users', user.uid), {
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        isPremium: false,
                        activity: null,
                        frequency: null,
                        intensity: null,
                        streak: 0,
                        weekData: [false,false,false,false,false,false,false],
                        excuses: [],
                        skipPassesUsed: 0,
                        customNotificationTimes: [],
                        notificationsEnabled: false,
                        createdAt: new Date().toISOString()
                    });
                    updateUserInfo(user);
                    showScreen('activity');
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                showScreen('login');
            }
        }

        function updateUserInfo(user) {
            const avatar = document.getElementById('user-avatar');
            const name = document.getElementById('user-name');
            const email = document.getElementById('user-email-display');
            if (avatar && user.photoURL) avatar.src = user.photoURL;
            if (name) name.textContent = user.displayName || 'User';
            if (email) email.textContent = user.email;
        }

        window.loadUserData = loadUserData;
        window.updateUserInfo = updateUserInfo;
    </script>
    <script>
        const PAYMENT_LINK = 'https://buy.stripe.com/test_4gM5kvgG73mvfKr4A4eQM00';
        
        window.appState = { 
            activity: null, frequency: null, intensity: null, streak: 0, 
            weekData: [false,false,false,false,false,false,false], excuses: [], 
            notificationsEnabled: false, isPremium: false, skipPassesUsed: 0, 
            customNotificationTimes: [], fcmToken: null 
        };

        function showScreen(screenId) { 
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); 
            document.getElementById('screen-' + screenId).classList.add('active'); 
            document.querySelectorAll('.nav-btn').forEach(btn => { btn.classList.toggle('active', btn.dataset.screen === screenId); }); 
            if (screenId === 'settings') updateSettingsScreen(); 
        }
        window.showScreen = showScreen;

        // Google Sign In
        document.getElementById('btn-google-signin').addEventListener('click', async () => {
            try {
                await window.signInWithPopup(window.auth, window.provider);
            } catch (error) {
                console.error('Sign in error:', error);
                alert('Sign in failed. Please try again.');
            }
        });

        // Sign Out
        document.getElementById('btn-sign-out').addEventListener('click', async () => {
            if (confirm('Sign out?')) {
                await window.signOut(window.auth);
                window.appState = { activity: null, frequency: null, intensity: null, streak: 0, weekData: [false,false,false,false,false,false,false], excuses: [], notificationsEnabled: false, isPremium: false, skipPassesUsed: 0, customNotificationTimes: [], fcmToken: null };
                showScreen('login');
            }
        });

        // Save to Firestore
        async function saveToFirestore(data) {
            if (!window.currentUser) return;
            try {
                await window.updateDoc(window.doc(window.db, 'users', window.currentUser.uid), data);
                console.log('Saved to Firestore:', data);
            } catch (error) {
                console.error('Error saving to Firestore:', error);
            }
        }
        window.saveToFirestore = saveToFirestore;

        // Onboarding
        document.querySelectorAll('.activity-btn').forEach(btn => { 
            btn.addEventListener('click', () => { 
                document.querySelectorAll('.activity-btn').forEach(b => b.classList.remove('selected')); 
                btn.classList.add('selected'); 
                window.appState.activity = btn.dataset.activity; 
                document.getElementById('btn-continue-activity').disabled = false; 
            }); 
        });
        document.getElementById('btn-continue-activity').addEventListener('click', () => showScreen('frequency'));
        
        document.querySelectorAll('.frequency-btn').forEach(btn => { 
            btn.addEventListener('click', () => { 
                document.querySelectorAll('.frequency-btn').forEach(b => b.classList.remove('selected')); 
                btn.classList.add('selected'); 
                window.appState.frequency = parseInt(btn.dataset.frequency); 
                document.getElementById('btn-continue-frequency').disabled = false; 
            }); 
        });
        document.getElementById('btn-continue-frequency').addEventListener('click', () => showScreen('intensity'));
        document.getElementById('btn-back-frequency').addEventListener('click', () => showScreen('activity'));
        
        document.querySelectorAll('.intensity-option').forEach(btn => { 
            btn.addEventListener('click', () => { 
                const intensity = btn.dataset.intensity; 
                if (intensity === 'brutal' && !window.appState.isPremium) { alert('BRUTAL mode requires premium.'); return; } 
                document.querySelectorAll('.intensity-option').forEach(b => b.classList.remove('selected')); 
                btn.classList.add('selected'); 
                window.appState.intensity = intensity; 
                document.getElementById('btn-continue-intensity').disabled = false; 
            }); 
        });
        document.getElementById('btn-continue-intensity').addEventListener('click', async () => {
            // Save onboarding choices to Firestore
            await saveToFirestore({
                activity: window.appState.activity,
                frequency: window.appState.frequency,
                intensity: window.appState.intensity
            });
            showScreen('permission');
        });
        document.getElementById('btn-back-intensity').addEventListener('click', () => showScreen('frequency'));

        // Notifications
        document.getElementById('btn-enable-notifications').addEventListener('click', async () => { 
            await enableNotifications(); 
            showScreen('home'); 
        });
        document.getElementById('btn-skip-notifications').addEventListener('click', () => { 
            alert('Fine. But don\'t blame us when you skip every workout.'); 
            showScreen('home'); 
        });

        async function enableNotifications() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                window.appState.notificationsEnabled = (permission === 'granted');
                if (window.appState.notificationsEnabled) {
                    try {
                        const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                        console.log('Service Worker registered:', registration);
                        await navigator.serviceWorker.ready;
                        console.log('Service Worker ready');
                        if (window.messaging && window.getToken) {
                            const token = await window.getToken(window.messaging, { 
                                vapidKey: 'BO7gUuHBFaJW8YakqXVdr-uVlRsbHOlwZwf1vQ93Y_yuQKEiAubnxPfuCtCWwDJzFZ-_db1knnc7JSKTDW7dx_E', 
                                serviceWorkerRegistration: registration 
                            });
                            if (token) { 
                                console.log('FCM Token:', token); 
                                window.appState.fcmToken = token;
                                await saveToFirestore({ fcmToken: token, notificationsEnabled: true });
                                scheduleNotifications(); 
                                alert('Notifications enabled. No more excuses.'); 
                            }
                        }
                    } catch (error) { console.error('Service Worker registration failed:', error); }
                } else { alert('You denied notifications.'); }
            }
        }

        async function scheduleNotifications() {
            if (!window.appState.notificationsEnabled || !window.appState.fcmToken || !window.currentUser) return;
            let intervals = window.appState.isPremium && window.appState.customNotificationTimes.length > 0 ? window.appState.customNotificationTimes : window.appState.intensity === 'chill' ? [10, 16] : window.appState.intensity === 'brutal' && window.appState.isPremium ? [7,9,11,13,15,17,19,21] : [9, 13, 18];
            console.log('Notification schedule:', intervals.map(t => t + ':00').join(', '));
            try {
                const response = await fetch('https://us-central1-ynotrun-7cd5c.cloudfunctions.net/updateUserSettings', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ 
                        fcmToken: window.appState.fcmToken, 
                        oderId: window.currentUser.uid,
                        email: window.currentUser.email, 
                        intensity: window.appState.intensity, 
                        isPremium: window.appState.isPremium, 
                        customNotificationTimes: window.appState.customNotificationTimes, 
                        notificationsEnabled: window.appState.notificationsEnabled 
                    }) 
                });
                const result = await response.json();
                console.log('Backend response:', result);
            } catch (error) { console.error('Error updating notification settings:', error); }
        }

        // Home actions
        document.getElementById('btn-log-workout').addEventListener('click', async () => { 
            const today = new Date().getDay(); 
            const dayIndex = today === 0 ? 6 : today - 1; 
            if (!window.appState.weekData[dayIndex]) { 
                window.appState.weekData[dayIndex] = true; 
                window.appState.streak++; 
                await saveToFirestore({ weekData: window.appState.weekData, streak: window.appState.streak, lastWorkout: new Date().toISOString() });
                updateHomeScreen(); 
                alert('GOOD. Keep it up.'); 
            } else { 
                alert('You already logged today.'); 
            } 
        });
        
        document.getElementById('btn-skip-today').addEventListener('click', async () => { 
            if (window.appState.isPremium && window.appState.skipPassesUsed < 1) { 
                if (confirm('Use skip pass to protect streak?')) { 
                    window.appState.skipPassesUsed++; 
                    await saveToFirestore({ skipPassesUsed: window.appState.skipPassesUsed });
                    alert('Skip pass used. Streak protected.'); 
                    return; 
                } 
            } 
            const excuse = prompt('Why are you skipping?'); 
            if (excuse) { 
                window.appState.excuses.push({ date: new Date().toLocaleDateString(), reason: excuse }); 
                window.appState.streak = 0; 
                await saveToFirestore({ excuses: window.appState.excuses, streak: 0 });
                updateHomeScreen(); 
                alert('Pathetic. Your excuse has been recorded.'); 
            } 
        });

        function updateHomeScreen() {
            document.getElementById('streak-count').textContent = window.appState.streak || 0;
            const weekGrid = document.getElementById('week-grid');
            const days = ['M','T','W','T','F','S','S'];
            const weekData = window.appState.weekData || [false,false,false,false,false,false,false];
            weekGrid.innerHTML = weekData.map((completed, i) => '<div class="day-box ' + (completed ? 'completed' : '') + '">' + days[i] + '</div>').join('');
            const excuseList = document.getElementById('excuse-list');
            const excuses = window.appState.excuses || [];
            if (excuses.length === 0) { excuseList.innerHTML = '<div class="excuse-title">YOUR EXCUSES THIS WEEK</div><div class="excuse-item">No excuses yet. Good.</div>'; }
            else { excuseList.innerHTML = '<div class="excuse-title">YOUR PATHETIC EXCUSES</div>' + excuses.slice(-5).reverse().map(e => '<div class="excuse-item">' + e.date + ': ' + e.reason + '</div>').join(''); }
            updatePremiumStatus();
        }
        window.updateHomeScreen = updateHomeScreen;

        function updateSettingsScreen() {
            const statusEl = document.getElementById('settings-status');
            if (window.appState.isPremium) { 
                statusEl.textContent = 'PREMIUM'; 
                statusEl.className = 'status-badge premium'; 
                document.getElementById('btn-manage-subscription').style.display = 'block'; 
                document.getElementById('btn-upgrade-settings').style.display = 'none'; 
            } else { 
                statusEl.textContent = 'FREE'; 
                statusEl.className = 'status-badge free'; 
                document.getElementById('btn-manage-subscription').style.display = 'none'; 
                document.getElementById('btn-upgrade-settings').style.display = 'block'; 
            }
            document.getElementById('settings-activity').textContent = (window.appState.activity || 'run').toUpperCase();
            document.querySelectorAll('[data-setting-activity]').forEach(btn => { btn.classList.toggle('selected', btn.dataset.settingActivity === window.appState.activity); });
            document.getElementById('settings-frequency').textContent = window.appState.frequency === 7 ? 'DAILY' : (window.appState.frequency || 5) + 'x/week';
            document.querySelectorAll('[data-setting-frequency]').forEach(btn => { btn.classList.toggle('selected', parseInt(btn.dataset.settingFrequency) === window.appState.frequency); });
            document.getElementById('settings-intensity').textContent = (window.appState.intensity || 'real').toUpperCase();
            document.querySelectorAll('[data-setting-intensity]').forEach(btn => { btn.classList.toggle('selected', btn.dataset.settingIntensity === window.appState.intensity); btn.classList.toggle('disabled', btn.dataset.settingIntensity === 'brutal' && !window.appState.isPremium); });
            document.getElementById('brutal-notice').style.display = window.appState.isPremium ? 'none' : 'block';
            document.getElementById('settings-notifications').textContent = window.appState.notificationsEnabled ? 'ENABLED' : 'DISABLED';
        }
        window.updateSettingsScreen = updateSettingsScreen;

        // Settings handlers
        document.querySelectorAll('[data-setting-activity]').forEach(btn => { 
            btn.addEventListener('click', async () => { 
                window.appState.activity = btn.dataset.settingActivity; 
                await saveToFirestore({ activity: window.appState.activity });
                updateSettingsScreen(); 
                scheduleNotifications(); 
            }); 
        });
        document.querySelectorAll('[data-setting-frequency]').forEach(btn => { 
            btn.addEventListener('click', async () => { 
                window.appState.frequency = parseInt(btn.dataset.settingFrequency); 
                await saveToFirestore({ frequency: window.appState.frequency });
                updateSettingsScreen(); 
            }); 
        });
        document.querySelectorAll('[data-setting-intensity]').forEach(btn => { 
            btn.addEventListener('click', async () => { 
                if (btn.dataset.settingIntensity === 'brutal' && !window.appState.isPremium) { alert('BRUTAL mode requires Premium.'); return; } 
                window.appState.intensity = btn.dataset.settingIntensity; 
                await saveToFirestore({ intensity: window.appState.intensity });
                updateSettingsScreen(); 
                scheduleNotifications(); 
                alert('Intensity changed to ' + window.appState.intensity.toUpperCase()); 
            }); 
        });
        document.getElementById('btn-enable-notifications-settings').addEventListener('click', async () => { await enableNotifications(); updateSettingsScreen(); });
        
        // FIXED: Open payment in new tab instead of redirecting
        document.getElementById('btn-upgrade-settings').addEventListener('click', () => { 
            if (window.currentUser) {
                window.open(PAYMENT_LINK + '?client_reference_id=' + window.currentUser.uid, '_blank');
            }
        });
        document.getElementById('btn-manage-subscription').addEventListener('click', () => { alert('To manage your subscription, email support@ynotrun.com'); });

        // FAQ accordion
        document.querySelectorAll('.faq-question').forEach(q => { q.addEventListener('click', () => { q.parentElement.classList.toggle('open'); }); });

        // Time picker
        function initTimePicker() {
            const grid = document.getElementById('time-picker-grid');
            grid.innerHTML = '';
            for (let hour = 6; hour <= 22; hour++) {
                const btn = document.createElement('button');
                btn.className = 'time-slot';
                btn.textContent = (hour > 12 ? hour - 12 : hour) + (hour >= 12 ? 'pm' : 'am');
                if ((window.appState.customNotificationTimes || []).includes(hour)) btn.classList.add('selected');
                btn.addEventListener('click', () => {
                    const times = window.appState.customNotificationTimes || [];
                    const idx = times.indexOf(hour);
                    if (idx > -1) { times.splice(idx, 1); btn.classList.remove('selected'); }
                    else { if (times.length >= 8) { alert('Max 8 times.'); return; } times.push(hour); times.sort((a,b) => a-b); btn.classList.add('selected'); }
                    window.appState.customNotificationTimes = times;
                    updateCurrentTimesDisplay();
                });
                grid.appendChild(btn);
            }
            updateCurrentTimesDisplay();
        }
        function updateCurrentTimesDisplay() { 
            const display = document.getElementById('current-times-display'); 
            const times = window.appState.customNotificationTimes || [];
            display.textContent = times.length === 0 ? 'Select up to 8 times' : 'Selected: ' + times.map(h => (h > 12 ? h-12 : h) + (h >= 12 ? 'pm' : 'am')).join(', '); 
        }
        document.getElementById('btn-save-times').addEventListener('click', async () => { 
            if ((window.appState.customNotificationTimes || []).length === 0) { alert('Select at least one time.'); return; } 
            await saveToFirestore({ customNotificationTimes: window.appState.customNotificationTimes });
            scheduleNotifications(); 
            alert('Times saved!'); 
        });

        function updatePremiumStatus() {
            const premiumBanner = document.getElementById('premium-banner');
            const upgradeBtn = document.getElementById('btn-upgrade');
            const homeTagline = document.getElementById('home-tagline');
            const freeUserPrompt = document.getElementById('free-user-prompt');
            const customTimesSection = document.getElementById('custom-times-section');
            if (window.appState.isPremium) {
                if (premiumBanner) premiumBanner.style.display = 'none';
                if (upgradeBtn) upgradeBtn.style.display = 'none';
                if (freeUserPrompt) freeUserPrompt.style.display = 'none';
                if (customTimesSection) { customTimesSection.classList.add('visible'); initTimePicker(); }
                if (homeTagline) { homeTagline.innerHTML = 'PREMIUM ACTIVE'; homeTagline.style.color = 'var(--red)'; }
                document.querySelectorAll('.premium-feature').forEach(f => { f.classList.remove('locked'); f.classList.add('unlocked'); const s = f.querySelector('.premium-feature-status'); if (s) s.textContent = '‚úì UNLOCKED'; });
            } else {
                if (freeUserPrompt) freeUserPrompt.style.display = 'block';
                if (customTimesSection) customTimesSection.classList.remove('visible');
                document.querySelectorAll('.premium-feature').forEach(f => { f.classList.add('locked'); f.classList.remove('unlocked'); const s = f.querySelector('.premium-feature-status'); if (s) s.textContent = 'üîí LOCKED'; });
            }
        }

        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => { btn.addEventListener('click', () => showScreen(btn.dataset.screen)); });
        
        // FIXED: Open payment in new tab instead of redirecting
        document.getElementById('btn-upgrade').addEventListener('click', () => { 
            if (window.currentUser) {
                window.open(PAYMENT_LINK + '?client_reference_id=' + window.currentUser.uid, '_blank');
            }
        });

        // Check for successful payment on page load
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'true') {
            // Payment was successful - Firestore will be updated by webhook
            // But let's refresh user data to get the updated premium status
            window.history.replaceState({}, document.title, window.location.pathname);
            setTimeout(async () => {
                if (window.currentUser) {
                    await window.loadUserData(window.currentUser);
                    alert('PREMIUM ACTIVATED! Welcome to hardcore mode.');
                }
            }, 2000);
        }

        // Weekly reset check
        (function checkWeekReset() { 
            const lastReset = localStorage.getItem('ynotrun_last_reset'); 
            const now = new Date(); 
            const currentMonday = new Date(now.setDate(now.getDate() - now.getDay() + 1)).toDateString(); 
            if (lastReset !== currentMonday && window.currentUser) { 
                window.appState.weekData = [false,false,false,false,false,false,false]; 
                window.appState.skipPassesUsed = 0; 
                localStorage.setItem('ynotrun_last_reset', currentMonday); 
                saveToFirestore({ weekData: window.appState.weekData, skipPassesUsed: 0 });
            } 
        })();
    </script>
</body>
</html>
